
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ Text Tabs</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .status-panel {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .current-db {
            font-size: 18px;
            font-weight: bold;
            color: #1976d2;
        }
        .switch-container {
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #4CAF50;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .danger {
            background: #f44336;
        }
        .danger:hover {
            background: #d32f2f;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }
        .info-panel {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .status-connected {
            background: #4CAF50;
        }
        .status-disconnected {
            background: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ Text Tabs Admin</h1>
        
        <div class="status-panel">
            <div class="current-db">–¢–µ–∫—É—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: <span id="currentDb">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
            <div class="connection-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</span>
            </div>
        </div>

        <div class="switch-container">
            <span>MySQL</span>
            <label class="switch">
                <input type="checkbox" id="dbSwitch">
                <span class="slider"></span>
            </label>
            <span>Supabase</span>
        </div>

        <div class="info-panel">
            <h3>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</h3>
            <p>–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:</p>
            <button onclick="createAdmin()">–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
            <button onclick="testConnection()" class="danger">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
        </div>

        <div class="info-panel">
            <h3>üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
            <button onclick="checkTables()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –ë–î</button>
            <button onclick="createTables()">–°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã</button>
            <button onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
            <button onclick="exportSettings()">–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
        </div>

        <div id="messages"></div>

        <div class="info-panel">
            <h3>üìñ –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ —Ñ–∞–π–ª—É:</h3>
            <ul>
                <li><strong>–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î</strong> - –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π —Å—Ö–µ–º—ã</li>
                <li><strong>–ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç</strong> - —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</li>
                <li><strong>–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</strong> - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫</li>
                <li><strong>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</strong> - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤</li>
                <li><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP</strong> - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—á—Ç—ã</li>
                <li><strong>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</strong> - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤</li>
                <li><strong>–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</strong> - —É–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
                <li><strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î</strong> - —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤</li>
            </ul>
        </div>
    </div>

    <script>
        let currentDatabase = 'mysql';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentSettings();
            checkDatabaseConnection();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
        async function loadCurrentSettings() {
            try {
                const response = await fetch('/api/project-settings.php?action=get_current_db');
                const data = await response.json();
                
                if (data.success) {
                    currentDatabase = data.database;
                    updateUI();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('currentDb').textContent = 
                currentDatabase === 'mysql' ? 'MySQL' : 'Supabase';
            document.getElementById('dbSwitch').checked = currentDatabase === 'supabase';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('dbSwitch').addEventListener('change', async function() {
            const newDb = this.checked ? 'supabase' : 'mysql';
            
            try {
                const response = await fetch('/api/project-settings.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'switch_database',
                        database: newDb
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    currentDatabase = newDb;
                    updateUI();
                    showMessage(`–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∞ –Ω–∞ ${newDb === 'mysql' ? 'MySQL' : 'Supabase'}`, 'success');
                    checkDatabaseConnection();
                } else {
                    this.checked = currentDatabase === 'supabase';
                    showMessage('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ë–î: ' + data.error, 'error');
                }
            } catch (error) {
                this.checked = currentDatabase === 'supabase';
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        });

        // –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        async function createAdmin() {
            try {
                const response = await fetch('/api/project-settings.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'create_admin'
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    showMessage(`–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω! –õ–æ–≥–∏–Ω: ${data.login}, –ü–∞—Ä–æ–ª—å: ${data.password}`, 'success');
                } else {
                    showMessage('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
        async function checkDatabaseConnection() {
            try {
                const response = await fetch('/api/project-settings.php?action=test_connection');
                const data = await response.json();
                
                const indicator = document.getElementById('statusIndicator');
                const statusText = document.getElementById('statusText');
                
                if (data.success) {
                    indicator.className = 'status-indicator status-connected';
                    statusText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ';
                } else {
                    indicator.className = 'status-indicator status-disconnected';
                    statusText.textContent = '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                }
            } catch (error) {
                const indicator = document.getElementById('statusIndicator');
                const statusText = document.getElementById('statusText');
                indicator.className = 'status-indicator status-disconnected';
                statusText.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏';
            }
        }

        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function testConnection() {
            checkDatabaseConnection();
            showMessage('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞', 'success');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
        async function checkTables() {
            try {
                const response = await fetch('/api/project-settings.php?action=check_tables');
                const data = await response.json();
                
                if (data.success) {
                    const missing = data.missing_tables || [];
                    if (missing.length === 0) {
                        showMessage('–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç', 'success');
                    } else {
                        showMessage(`–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–∞–±–ª–∏—Ü—ã: ${missing.join(', ')}`, 'error');
                    }
                } else {
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
        async function createTables() {
            try {
                const response = await fetch('/api/project-settings.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'create_tables'
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    showMessage('–¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    showMessage('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
        function clearCache() {
            localStorage.clear();
            sessionStorage.clear();
            showMessage('–ö—ç—à –æ—á–∏—â–µ–Ω', 'success');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function exportSettings() {
            const settings = {
                database: currentDatabase,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'project-settings.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }

        // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(message, type) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
